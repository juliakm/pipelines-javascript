trigger: 
- master

pool: 
   vmImage: ubuntu-latest

steps:
- powershell: |
      $PAT = "cxtwoltptmmg3vzdzzy2uqyhao437ec2anw6bys5imgz6geioi3q"
      $OrganizationName = "jukullam"
      Start-Sleep -s 190
      $AzureDevOpsAuthenicationHeader = @{Authorization = 'Basic ' + [Convert]::ToBase64String([Text.Encoding]::ASCII.GetBytes(":$($PAT)")) }

      $UriOrga = "https://dev.azure.com/$($OrganizationName)/" 
      $uriAccount = $UriOrga + "_apis/projects?api-version=5.1"

      Invoke-RestMethod -Uri $uriAccount -Method get -Headers $AzureDevOpsAuthenicationHeader 

      $uriProcess = $UriOrga + "_apis/process/processes?api-version=5.1"
      Invoke-RestMethod -Uri $uriProcess -Method get -Headers $AzureDevOpsAuthenicationHeader

- task: InvokeRESTAPI@1
  inputs:
   connectionType: 'connectedServiceNameARM'
   azureServiceConnection: 'DevOps Pipelines - ARM Horizontal Work (82c135d4-f813-4bec-a93e-60e4323918ee)'
   method: 'POST'
   waitForCompletion: 'false'


# stages:
#   - stage: 'first'
#     jobs:
#     - job: 'firststage_job1'
#       steps:
#       - script: |
#               echo "attempt is changing with number of attempts"
#               echo "current attempt is $(system.stageattempt)"
#               echo "current checks is $(checks.stageattempt)"
#               exit 1
#         displayName: 'ischanging-$(system.stageattempt)'     
#         continueOnError: true
#   - stage: 'second'
#     dependsOn: 
#     - first
#     jobs:
#     - deployment: DeployWeb1
#       timeoutInMinutes: 7200
#       displayName: job1
#       environment: 
#         name: ContosoDeploy
#         resourceType: VirtualMachine
#       strategy:
#         runOnce:
#           deploy:
#             steps:
#             - script: |
#                 echo "attempt is changing with number of attempts"
#                 echo "current attempt is $(system.stageattempt)"
#                 echo "current checks attempt is $(checks.stageattempt)"
#                 exit 1
#               displayName: "notchanging-$(system.stageattempt)"
#               continueOnError: true

